apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  generateName: build-run-   # ✅ Unique name auto-generated
spec:
  pipelineRef:
    name: build-and-deploy-pipeline
  params:
    - name: git-url
      value: https://github.com/vinaysunhare/Dockerized-Rails-app-with-PostgreSQL.git
    - name: image-url
      value: docker.io/vinaysunhare/railsapp:latest
    - name: DOCKERFILE
      value: Dockerfile       # ✅ Changed from k8s/Dockerfile to Dockerfile (assumes Dockerfile is at root)
    - name: CONTEXT
      value: .               # ✅ Changed from k8s to . (uses root of cloned repo as context)
  workspaces:
    - name: shared-workspace
      emptyDir: {}
  serviceAccountName: default
  podTemplate:
    imagePullSecrets:
      - name: regcred  # ✅ DockerHub credentials secret (ensure it exists)